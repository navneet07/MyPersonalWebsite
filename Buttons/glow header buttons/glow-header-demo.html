<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glow Header Navigation Demo</title>
    <style>
        @import url('https://unpkg.com/normalize.css') layer(normalize);

        @layer normalize, base, demo, spotlight;

        @layer spotlight {
          nav::before,
          nav::after,
          nav ul.lit {
            filter: url('#spotlight');
          }

          ul.content::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 100px;
            pointer-events: none;
            border: 1px solid white;
            filter: url('#ambience') brightness(2);
          }

          ul.lit {
            position: absolute;
            inset: 0;
            z-index: 2;
          }

          [data-active='true'] {
            opacity: 0.8;
          }
        }

        @layer demo {
          nav {
            height: 44px;
            border-radius: 100px;
            border: 1px solid color-mix(in hsl, canvasText, #0000 75%);
            position: relative;

            &::before,
            &::after {
              pointer-events: none;
            }

            &::after {
              background: color-mix(in hsl, canvas, canvasText 10%);
              content: '';
              position: absolute;
              inset: 0;
              border: 1px solid color-mix(in hsl, canvasText, #0000);
              z-index: -1;
              border-radius: 100px;
              opacity: 0.15;
            }

            &::before {
              content: '';
              position: absolute;
              inset: 0;
              border: 1px solid color-mix(in hsl, canvasText, #0000);
              z-index: 2;
              border-radius: 100px;
            }

            ul {
              display: flex;
              align-items: center;
              padding: 0;
              margin: 0;
              list-style-type: none;
              height: 100%;
              font-size: 0.875rem;

              &.lit {
                pointer-events: none;

                li {
                  padding: 0.5rem 1.25rem;
                }
              }

              li {
                height: 100%;
                display: grid;
                place-items: center;
                a {
                  display: grid;
                  place-items: center;
                  height: 100%;
                  padding: 0.5rem 1.25rem;
                  text-decoration: none;
                  color: inherit;
                  opacity: 0.4;
                  transition: opacity 0.25s ease-out;

                  &:is(:hover, :focus-visible) {
                    opacity: 1;
                  }

                  span {
                    pointer-events: none;
                  }
                }
              }
            }
          }
        }

        @layer base {
          :root {
            --font-size-min: 16;
            --font-size-max: 20;
            --font-ratio-min: 1.2;
            --font-ratio-max: 1.33;
            --font-width-min: 375;
            --font-width-max: 1500;
          }

          html {
            color-scheme: light dark;
          }

          [data-theme='light'] {
            color-scheme: light only;
          }

          [data-theme='dark'] {
            color-scheme: dark only;
          }

          *,
          *:after,
          *:before {
            box-sizing: border-box;
          }

          body {
            background: light-dark(#fff, #000);
            display: grid;
            place-items: center;
            min-height: 100vh;
            font-family: 'SF Pro Text', 'SF Pro Icons', 'AOS Icons', 'Helvetica Neue',
              Helvetica, Arial, sans-serif, system-ui;
            gap: 2rem;
            padding: 2rem;
          }

          body::before {
            --size: 45px;
            --line: color-mix(in hsl, canvasText, transparent 70%);
            content: '';
            height: 100vh;
            width: 100vw;
            position: fixed;
            background: linear-gradient(
                  90deg,
                  var(--line) 1px,
                  transparent 1px var(--size)
                )
                50% 50% / var(--size) var(--size),
              linear-gradient(var(--line) 1px, transparent 1px var(--size)) 50% 50% /
                var(--size) var(--size);
            mask: linear-gradient(-20deg, transparent 50%, white);
            top: 0;
            transform-style: flat;
            pointer-events: none;
            z-index: -1;
          }

          .diamond {
            color: canvasText;
            position: fixed;
            top: 1rem;
            left: 1rem;
            width: 48px;
            aspect-ratio: 1;
            display: grid;
            place-items: center;
            opacity: 0.8;
            svg {
              width: 65%;
            }
          }

          .diamond:is(:hover, :focus-visible) {
            opacity: 1;
          }

          .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
          }

          /* Demo specific styles */
          .demo-container {
            text-align: center;
            max-width: 600px;
          }

          .demo-title {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: canvasText;
          }

          .demo-description {
            margin-bottom: 2rem;
            color: canvasText;
            opacity: 0.8;
            line-height: 1.6;
          }

          .controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
            flex-wrap: wrap;
          }

          .theme-btn {
            padding: 0.5rem 1rem;
            border: 1px solid color-mix(in hsl, canvasText, #0000 75%);
            background: canvas;
            color: canvasText;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s ease;
          }

          .theme-btn:hover {
            opacity: 0.8;
          }

          .current-selection {
            margin-top: 2rem;
            padding: 1rem;
            background: color-mix(in srgb, canvasText 5%, transparent);
            border-radius: 8px;
            color: canvasText;
            font-weight: 500;
          }
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <h1 class="demo-title">Glow Header Navigation</h1>
        <p class="demo-description">
            Interactive navigation header with spotlight glow effects. Hover over navigation items 
            to see the lighting effects in action. Features smooth animations and theme switching.
        </p>

        <a class="diamond" href="#">
            <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 -960 960 960"
                fill="currentColor"
            >
                <path
                d="M480-120 80-600l120-240h560l120 240-400 480Zm-95-520h190l-60-120h-70l-60 120Zm55 347v-267H218l222 267Zm80 0 222-267H520v267Zm144-347h106l-60-120H604l60 120Zm-474 0h106l60-120H250l-60 120Z"
                />
            </svg>
        </a>

        <nav>
            <ul aria-hidden="true" class="lit">
                <li>About</li>
                <li>Projects</li>
                <li>Skills</li>
                <li>Contact</li>
            </ul>
            <ul class="content">
                <li>
                    <a data-active="true" href="#about"><span>About</span></a>
                </li>
                <li>
                    <a href="#projects"><span>Projects</span></a>
                </li>
                <li>
                    <a href="#skills"><span>Skills</span></a>
                </li>
                <li>
                    <a href="#contact"><span>Contact</span></a>
                </li>
            </ul>
        </nav>

        <div class="current-selection" id="selection-display">
            Current Selection: About
        </div>

        <div class="controls">
            <button class="theme-btn" onclick="toggleTheme()">Toggle Theme</button>
        </div>
    </div>

    <!-- SVG Filters for glow effects -->
    <svg class="sr-only">
        <filter id="spotlight">
            <feGaussianBlur
                in="SourceAlpha"
                stdDeviation="0.8"
                result="blur"
            ></feGaussianBlur>
            <feSpecularLighting
                result="lighting"
                in="blur"
                surfaceScale="0.5"
                specularConstant="6"
                specularExponent="65"
                lighting-color="hsla(234, 14%, 72%, 0.25)"
            >
                <fePointLight x="50" y="54" z="82"></fePointLight>
            </feSpecularLighting>
            <feComposite
                in="lighting"
                in2="SourceAlpha"
                operator="in"
                result="composite"
            ></feComposite>
            <feComposite
                in="merged"
                in2="composite"
                operator="arithmetic"
                k1="0"
                k2="1"
                k3="1"
                k4="0"
                result="litPaint"
            ></feComposite>
        </filter>
        <filter id="ambience">
            <feGaussianBlur
                in="SourceAlpha"
                stdDeviation="0.8"
                result="blur"
            ></feGaussianBlur>
            <feSpecularLighting
                result="lighting"
                in="blur"
                surfaceScale="0.5"
                specularConstant="25"
                specularExponent="65"
                lighting-color="hsla(234, 14%, 72%, 0.25)"
            >
                <fePointLight x="120" y="-154" z="160"></fePointLight>
            </feSpecularLighting>
            <feComposite
                in="lighting"
                in2="SourceAlpha"
                operator="in"
                result="composite"
            ></feComposite>
            <feComposite
                in="merged"
                in2="composite"
                operator="arithmetic"
                k1="0"
                k2="1"
                k3="1"
                k4="0"
                result="litPaint"
            ></feComposite>
        </filter>
    </svg>

    <script type="module">
        // Import required libraries
        const gsap = await import('https://cdn.skypack.dev/gsap@3.12.0');
        const { Pane } = await import('https://cdn.skypack.dev/tweakpane@4.0.4');

        // Full configuration object with all interactive settings
        const config = {
            theme: 'light',
            spotlight: {
                speed: 0.25,
                deviation: 0.8,
                surface: 0.5,
                specular: 6,
                exponent: 65,
                light: 'hsla(234, 14%, 72%, 0.25)',
                x: 0,
                y: 54,
                z: 82,
                pointer: false,
            },
            ambience: {
                deviation: 0.8,
                surface: 0.5,
                specular: 25,
                exponent: 65,
                light: 'hsla(234, 14%, 72%, 0.25)',
                x: 120,
                y: -154,
                z: 160,
            },
        };

        // Create the interactive control panel
        const ctrl = new Pane({
            title: 'Glow Controls',
            expanded: true,
        });

        // Navigation elements
        const nav = document.querySelector('nav');
        const links = nav.querySelectorAll('a');
        const selectionDisplay = document.getElementById('selection-display');

        // SVG filter elements
        const spotlightfeGaussianBlur = document.querySelector('#spotlight feGaussianBlur');
        const spotlightfeSpecularLighting = document.querySelector('#spotlight feSpecularLighting');
        const spotlightfePointLight = document.querySelector('#spotlight fePointLight');
        const ambiencefeGaussianBlur = document.querySelector('#ambience feGaussianBlur');
        const ambiencefeSpecularLighting = document.querySelector('#ambience feSpecularLighting');
        const ambiencefePointLight = document.querySelector('#ambience fePointLight');

        // Mouse tracking for pointer mode
        const syncLight = ({ x, y }) => {
            const navBounds = nav.getBoundingClientRect();
            spotlightfePointLight.setAttribute('x', Math.floor(x - navBounds.x));
            spotlightfePointLight.setAttribute('y', Math.floor(y - navBounds.y));
        };

        let monitoring = false;

        // Main update function - applies all settings to SVG filters
        const update = () => {
            document.documentElement.dataset.theme = config.theme;
            
            // Update spotlight settings
            spotlightfeGaussianBlur.setAttribute('stdDeviation', config.spotlight.deviation);
            spotlightfeSpecularLighting.setAttribute('surfaceScale', config.spotlight.surface);
            spotlightfeSpecularLighting.setAttribute('specularConstant', config.spotlight.specular);
            spotlightfeSpecularLighting.setAttribute('specularExponent', config.spotlight.exponent);
            spotlightfeSpecularLighting.setAttribute('lighting-color', config.spotlight.light);
            
            // Update ambience settings
            ambiencefeGaussianBlur.setAttribute('stdDeviation', config.ambience.deviation);
            ambiencefeSpecularLighting.setAttribute('surfaceScale', config.ambience.surface);
            ambiencefeSpecularLighting.setAttribute('specularConstant', config.ambience.specular);
            ambiencefeSpecularLighting.setAttribute('specularExponent', config.ambience.exponent);
            ambiencefeSpecularLighting.setAttribute('lighting-color', config.ambience.light);

            // Position the lights
            const anchor = document.querySelector('[data-active="true"]');
            if (anchor) {
                const navBounds = nav.getBoundingClientRect();
                const anchorBounds = anchor.getBoundingClientRect();

                spotlightfePointLight.setAttribute('x', 
                    anchorBounds.left - navBounds.left + anchorBounds.width * 0.5 + config.spotlight.x
                );
                spotlightfePointLight.setAttribute('y', config.spotlight.y);
                spotlightfePointLight.setAttribute('z', config.spotlight.z);
            }

            ambiencefePointLight.setAttribute('x', config.ambience.x);
            ambiencefePointLight.setAttribute('y', config.ambience.y);
            ambiencefePointLight.setAttribute('z', config.ambience.z);

            // Handle pointer tracking mode
            if (config.spotlight.pointer && !monitoring) {
                monitoring = true;
                nav.dataset.pointerLighting = true;
                window.addEventListener('pointermove', syncLight);
            } else if (!config.spotlight.pointer) {
                monitoring = false;
                nav.dataset.pointerLighting = false;
                window.removeEventListener('pointermove', syncLight);
            }
        };

        // Function to smoothly animate to new active item
        const selectAnchor = (anchor) => {
            if (!config.spotlight.pointer) {
                const navBounds = nav.getBoundingClientRect();
                const anchorBounds = anchor.getBoundingClientRect();
                
                // Update active states
                for (const link of links) link.dataset.active = anchor === link;
                
                // Update selection display
                const linkText = anchor.querySelector('span').textContent;
                selectionDisplay.textContent = `Current Selection: ${linkText}`;
                
                // Animate spotlight to new position
                gsap.default.to(spotlightfePointLight, {
                    duration: config.spotlight.speed,
                    attr: {
                        x: anchorBounds.left - navBounds.left + anchorBounds.width * 0.5 + config.spotlight.x,
                    },
                });
            }
        };

        // Sync function with view transition support
        const sync = (event) => {
            if (!document.startViewTransition || 
                event.target.controller.view.labelElement.innerText !== 'Theme') {
                return update();
            }
            document.startViewTransition(() => update());
        };

        // CREATE CONTROL PANEL FOLDERS AND CONTROLS

        // Spotlight controls folder
        const anchorLight = ctrl.addFolder({ title: 'Spotlight', expanded: true });

        anchorLight.addBinding(config.spotlight, 'speed', {
            min: 0.1,
            step: 0.1,
            max: 2.0,
            label: 'Animation Speed (s)',
        });

        // Spotlight Blur controls
        const blur = anchorLight.addFolder({ title: 'Gaussian Blur' });
        blur.addBinding(config.spotlight, 'deviation', {
            label: 'Blur Amount',
            min: 0,
            max: 10,
            step: 0.1,
        });

        // Spotlight Lighting controls  
        const lighting = anchorLight.addFolder({ title: 'Specular Lighting' });
        lighting.addBinding(config.spotlight, 'light', {
            label: 'Light Color',
        });
        lighting.addBinding(config.spotlight, 'surface', {
            label: 'Surface Scale',
            min: 0,
            max: 50,
            step: 0.1,
        });
        lighting.addBinding(config.spotlight, 'specular', {
            label: 'Specular Constant',
            min: 0,
            max: 25,
            step: 0.1,
        });
        lighting.addBinding(config.spotlight, 'exponent', {
            label: 'Specular Exponent',
            min: 0,
            max: 200,
            step: 1,
        });

        // Spotlight Position controls
        const point = anchorLight.addFolder({ title: 'Light Position' });
        point.addBinding(config.spotlight, 'x', {
            label: 'X Offset',
            min: -100,
            max: 100,
            step: 1,
        });
        point.addBinding(config.spotlight, 'y', {
            label: 'Y Offset',
            min: -100,
            max: 100,
            step: 1,
        });
        point.addBinding(config.spotlight, 'z', {
            label: 'Z Distance',
            min: 0,
            max: 500,
            step: 1,
        });
        point.addBinding(config.spotlight, 'pointer', {
            label: 'Follow Mouse',
        });

        // Ambience controls folder
        const ambientLight = ctrl.addFolder({ title: 'Ambient Light', expanded: false });

        const ambientblur = ambientLight.addFolder({ title: 'Gaussian Blur' });
        ambientblur.addBinding(config.ambience, 'deviation', {
            label: 'Blur Amount',
            min: 0,
            max: 10,
            step: 0.1,
        });

        const ambientlighting = ambientLight.addFolder({ title: 'Specular Lighting' });
        ambientlighting.addBinding(config.ambience, 'light', {
            label: 'Light Color',
        });
        ambientlighting.addBinding(config.ambience, 'surface', {
            label: 'Surface Scale',
            min: 0,
            max: 50,
            step: 0.1,
        });
        ambientlighting.addBinding(config.ambience, 'specular', {
            label: 'Specular Constant',
            min: 0,
            max: 25,
            step: 0.1,
        });
        ambientlighting.addBinding(config.ambience, 'exponent', {
            label: 'Specular Exponent',
            min: 0,
            max: 200,
            step: 1,
        });

        const ambientpoint = ambientLight.addFolder({ title: 'Light Position' });
        ambientpoint.addBinding(config.ambience, 'x', {
            label: 'X Position',
            min: -500,
            max: 500,
            step: 1,
        });
        ambientpoint.addBinding(config.ambience, 'y', {
            label: 'Y Position', 
            min: -500,
            max: 500,
            step: 1,
        });
        ambientpoint.addBinding(config.ambience, 'z', {
            label: 'Z Distance',
            min: 0,
            max: 500,
            step: 1,
        });

        // Theme control
        ctrl.addBinding(config, 'theme', {
            label: 'Theme',
            options: {
                System: 'system',
                Light: 'light', 
                Dark: 'dark',
            },
        });

        // Event listeners
        ctrl.on('change', sync);

        nav.addEventListener('click', (event) => {
            if (event.target.tagName === 'A') {
                event.preventDefault();
                selectAnchor(event.target);
            }
        });

        // Initialize everything
        update();
        
        // Set initial active item
        const initialActive = document.querySelector('[data-active="true"]');
        if (initialActive) {
            selectAnchor(initialActive);
        }
    </script>
</body>
</html>
